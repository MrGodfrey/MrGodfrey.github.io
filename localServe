import os
import subprocess
import threading
import sys

# 定义一个函数用于读取按键
def getch():
    try:
        # Windows系统
        import msvcrt
        return msvcrt.getch().decode()
    except ImportError:
        # 其他系统 (如Linux)
        import sys, tty, termios
        fd = sys.stdin.fileno()
        old_settings = termios.tcgetattr(fd)
        try:
            tty.setraw(sys.stdin.fileno())
            ch = sys.stdin.read(1)
        finally:
            termios.tcsetattr(fd, termios.TCSADRAIN, old_settings)
        return ch

# 定义一个函数，用于监视'q'按键并结束子进程
def monitor_key(proc1, proc2):
    while True:
        key = getch()
        if key == 'q':
            proc1.terminate()
            proc2.terminate()
            break

os.chdir('docs')
proc1 = subprocess.Popen(['python', '-m', 'http.server', '3000'], stdout=subprocess.DEVNULL,  stderr=subprocess.DEVNULL)

os.chdir('../toolbox')
proc2 = subprocess.Popen(['python', '-m', 'http.server', '4001'], stdout=subprocess.DEVNULL,  stderr=subprocess.DEVNULL)

print('Server at http://localhost:4000/ and http://localhost:3000/')

# 启动监视线程
monitor_thread = threading.Thread(target=monitor_key, args=(proc1, proc2))
monitor_thread.start()

print("按 q 结束进程")

monitor_thread.join()  # 等待监视线程结束
